# Transformation Rules Audit

| Row | Target Column | Raw Transformation (verbatim) | Parsed SQL Expression | Notes |
|---:|---|---|---|---|
| 18 | `asset_liblty_CD` | Set to +00331 (Asset). | `CAST(331 AS BIGINT)` |  |
| 26 | `compnd_int_CD` | Set to -2 (No Source). | `CAST(-2 AS BIGINT)` |  |
| 13 | `curncy_CD` | CASE WHEN mas.SRCURRCODE IN ('BEF', 'DEM', 'FRF', 'GRD', 'TEP', 'ITL','NLG','PTE') THEN '+00618' ELSE CASE WHEN mas.secrty_curncy_id IN (-3,-4) THEN '+00616' ELSE COALESCE(get stndrd_id('EDW','EDW_CURNCY_CD', 'N', mas.secrty_curncy_id), '+00616') END END AS CURNCY_CD FROM ossbr_2_1 mas | `CASE<br>   <br>    WHEN mas.SRCURRCODE IN ('BEF', 'DEM', 'FRF', 'GRD', 'TEP', 'ITL','NLG','PTE') <br>      THEN '+00618' <br>    ELSE CASE<br>   <br>    WHEN mas.secrty_curncy_id IN (-3,-4) <br>      THEN '+00616' <br>    ELSE COALESCE(get stndrd_id('EDW','EDW_CURNCY_CD', 'N', mas.secrty_curncy_id), '+00616') <br>  END <br>  END AS CURNCY_CD` | -- Source context preserved: FROM ossbr_2_1 mas |
| 34 | `cusip_id` | CASE WHEN RTRIM(mas.SRCUSIPNBR)=  THEN '000000000' ELSE mas.SRCUSIPNBR END AS CUSIP_ID FROM ossbr_2_1 mas | `CASE<br>   <br>    WHEN RTRIM(mas.SRCUSIPNBR)=  <br>      THEN '000000000' <br>    ELSE mas.SRCUSIPNBR <br>  END AS CUSIP_ID` | -- Source context preserved: FROM ossbr_2_1 mas |
| 25 | `erlcsh_eligbl_in` | CASE WHEN mas.SRSECTYPE = '210' THEN 'N' ELSE 'Y' END AS ERLCSH_ELIGBL_IN FROM ossbr_2_1 mas | `CASE<br>   <br>    WHEN mas.SRSECTYPE = '210' <br>      THEN 'N' <br>    ELSE 'Y' <br>  END AS ERLCSH_ELIGBL_IN` | -- Source context preserved: FROM ossbr_2_1 mas |
| 15 | `final_offer_dt` | Set to NULL | `CAST(NULL AS DATE)` |  |
| 14 | `first_offer_dt` | CASE WHEN TRY_CAST(mas.SBDSBDATE AS DATE) IS NOT NULL AND mas.SBDSBDATE <> '0001-01-01' THEN mas.SBDSBDATE ELSE NULL END AS FIRST_OFFER_DT FROM ossbr_2_1 mas | `CASE<br>   <br>    WHEN TRY_CAST(mas.SBDSBDATE AS DATE) IS NOT NULL AND mas.SBDSBDATE <> '0001-01-01' <br>      THEN mas.SBDSBDATE <br>    ELSE NULL <br>  END AS FIRST_OFFER_DT` | -- Source context preserved: FROM ossbr_2_1 mas |
| 38 | `fis_paper_type_CD` | Set A to A --1A | `CAST('A' AS BIGINT)` |  |
| 37 | `fis_secrty_id` | Set to 0 | `CAST(0 AS BIGINT)` |  |
| 20 | `int_freq_CD` | CASE -- Check if tantrum_FAMLY_CD is +01309 (MMK) or +01310 (FIX)   WHEN tantrum.INSTR_FAMILY_CD IN ('+01309', '+01310') THEN COALESCE(get_stndrd _id('EDW', 'EDW_INT_FREQ_CD', 'N', mas.SRPREQ),'-00001' -- Default to Not Applicable if no standard mapping is found   ELSE '-00001' -- Not Applicable   END AS INT_FREQ_CD FROM ossbr_2_1 mas LEFT JOIN tantrum tantrum ON mas.SRSECCODE = tantrum.SRSECCODE | `CASE<br>   -- Check if tantrum_FAMLY_CD is +01309 (MMK) or +01310 (FIX) <br> <br>    WHEN tantrum.INSTR_FAMILY_CD IN ('+01309', '+01310') <br>      THEN COALESCE(get_stndrd _id('EDW', 'EDW_INT_FREQ_CD', 'N', mas.SRPREQ),'-00001' -- Default to Not Applicable if no standard mapping is found <br> <br>    ELSE '-00001' -- Not Applicable <br> <br>  END AS INT_FREQ_CD` | -- NOTE: merged 3 duplicate definitions for target column 'int_freq_CD' |
| 24 | `int_rate_id` | Set to 0 | `CAST(0 AS BIGINT)` |  |
| 27 | `int_relatn_CD` | Set to -2 (No Source). | `CAST(-2 AS BIGINT)` |  |
| 23 | `int_rt` | CASE WHEN TRY_CAST(mas.SRPMTRATE AS FLAOT) IS NOT NULL AND mas.SRPMTRATE > 0 AND mas.SRPMTRATE <= 999.99999 THEN mas.SRPMTRATE ELSE NULL END AS INT_RT FROM ossbr_2_1 mas | `CASE<br>   <br>    WHEN TRY_CAST(mas.SRPMTRATE AS FLAOT) IS NOT NULL AND mas.SRPMTRATE > 0 AND mas.SRPMTRATE <= 999.99999 <br>      THEN mas.SRPMTRATE <br>    ELSE NULL <br>  END AS INT_RT` | -- Source context preserved: FROM ossbr_2_1 mas |
| 11 | `issuer_org_id` | Set to 0 | `CAST(0 AS BIGINT)` |  |
| 43 | `last_change_dt` | Set to etl.effective.start.date in the fromat yyyy-mm-dd | `TO_DATE('"""${etl.effective.start.date}"""', 'yyyyMMddHHmmss')` |  |
| 16 | `lifecy_CD` | Set to +00114 (Active). | `CAST(114 AS BIGINT)` |  |
| 46 | `load_ts` | set to current_timestamp() | `CURRENT_TIMESTAMP()` |  |
| 30 | `mu_fund_family_CD` | CASE WHEN ref.sm_SECURITY_CODE IS NOT NULL AND LEFT(ref.SEND_CD, 3) = 'SBB' THEN CASE WHEN edx.MFIN_SEND_NUMBER IS NOT NULL THEN CASE WHEN edx.MFIN_ASSET_ORDER = 1 THEN '+08830' -- MMK /n WHEN edx.MFIN_ASSET_ORDER = 2 THEN '+08831' -- PMMK /n WHEN edx.MFIN_ASSET_ORDER = 3 THEN '+08832' -- ING /n WHEN edx.MFIN_ASSET_ORDER = 4 THEN '+08833' -- BAL /n WHEN edx.MFIN_ASSET_ORDER = 5 THEN '+08834' -- INX /n WHEN edx.MFIN_ASSET_ORDER = 6 THEN '+08835' -- CDNEQ /n WHEN edx.MFIN_ASSET_ORDER = 7 THEN '+08836' -- USEQ /n WHEN edx.MFIN_ASSET_ORDER = 8 THEN '+08837' -- SEC /n WHEN edx.MFIN_ASSET_ORDER = 9 THEN '+08838' -- GLO /n WHEN edx.MFIN_ASSET_ORDER = 10 THEN '+08839' -- MAPM /n WHEN edx.MFIN_ASSET_ORDER = 11 THEN '+08840' -- MAP /n WHEN edx.MFIN_ASSET_ORDER - 12 THEN '+08841' -- MAP /n WHEN edx.MFIN_ASSET_ORDER - 13 THEN '+08842' -- GIC /n WHEN edx.MFIN_ASSET_ORDER = 14 THEN '+12553' -- COMFORT /n WHEN edx.MFIN_ASSET_ORDER = 15 THEN '+12554' -- ADVANTAGE /n WHEN edx.MFIN_ASSET_ORDER = 16 THEN '+12559' -- CORPORATE /n ELSE '-00004' -- Invalid /n END ELSE -'00001' -- Not Applicable /n END ELSE '-00001' -- Not Applicable /n END AS mu_fund_FAMILY_CD FROM ossbr_2_1 mas LEFT JOIN GLSREF ref ON mas.SRSECCODE = ref.sm_SECURITY_CODE LEFT JOIN MFIN ed ON SUBSTRING (ref.SEND_CD, 4, 5) = edx.MFIN_SEND_NUMBER | `CASE<br>   <br>    WHEN ref.sm_SECURITY_CODE IS NOT NULL AND LEFT(ref.SEND_CD, 3) = 'SBB' <br>      THEN CASE<br>   <br>    WHEN edx.MFIN_SEND_NUMBER IS NOT NULL <br>      THEN CASE<br>   <br>    WHEN edx.MFIN_ASSET_ORDER = 1 <br>      THEN '+08830' -- MMK /n <br>    WHEN edx.MFIN_ASSET_ORDER = 2 <br>      THEN '+08831' -- PMMK /n <br>    WHEN edx.MFIN_ASSET_ORDER = 3 <br>      THEN '+08832' -- ING /n <br>    WHEN edx.MFIN_ASSET_ORDER = 4 <br>      THEN '+08833' -- BAL /n <br>    WHEN edx.MFIN_ASSET_ORDER = 5 <br>      THEN '+08834' -- INX /n <br>    WHEN edx.MFIN_ASSET_ORDER = 6 <br>      THEN '+08835' -- CDNEQ /n <br>    WHEN edx.MFIN_ASSET_ORDER = 7 <br>      THEN '+08836' -- USEQ /n <br>    WHEN edx.MFIN_ASSET_ORDER = 8 <br>      THEN '+08837' -- SEC /n <br>    WHEN edx.MFIN_ASSET_ORDER = 9 <br>      THEN '+08838' -- GLO /n <br>    WHEN edx.MFIN_ASSET_ORDER = 10 <br>      THEN '+08839' -- MAPM /n <br>    WHEN edx.MFIN_ASSET_ORDER = 11 <br>      THEN '+08840' -- MAP /n <br>    WHEN edx.MFIN_ASSET_ORDER - 12 <br>      THEN '+08841' -- MAP /n <br>    WHEN edx.MFIN_ASSET_ORDER - 13 <br>      THEN '+08842' -- GIC /n <br>    WHEN edx.MFIN_ASSET_ORDER = 14 <br>      THEN '+12553' -- COMFORT /n <br>    WHEN edx.MFIN_ASSET_ORDER = 15 <br>      THEN '+12554' -- ADVANTAGE /n <br>    WHEN edx.MFIN_ASSET_ORDER = 16 <br>      THEN '+12559' -- CORPORATE /n <br>    ELSE '-00004' -- Invalid /n <br>  END <br>    ELSE -'00001' -- Not Applicable /n <br>  END <br>    ELSE '-00001' -- Not Applicable /n <br>  END AS mu_fund_FAMILY_CD` | -- NOTE: merged 2 variations for target column 'mu_fund_family_CD' |
| 28 | `mu_fund_id` | CASE WHEN ref.sm_SECURITY_CODE IS NOT NULL THEN ref.SEND_CD ELSE '00000000' END AS mu_fund_ID FROM ossbr_2_1 mas LEFT JOIN GLSXREF ref ON mas.SRSECCODE = ref.sm_SECURITY_CODE | `CASE<br>   <br>    WHEN ref.sm_SECURITY_CODE IS NOT NULL <br>      THEN ref.SEND_CD <br>    ELSE '00000000' <br>  END AS mu_fund_ID` | -- NOTE: merged 2 duplicate definitions for target column 'mu_fund_id' |
| 45 | `row_exclsn_dt` | Set to NULL | `CAST(NULL AS DATE)` |  |
| 40 | `secrty_class_id` | CASE WHEN TRY_CAST(mas.SRSECCLAS AS INT) IS NOT NULL THEN mas.SRSECCLAS ELSE '0' END AS SECRTY_CLASS_ID FROM ossbr_2_1 mas | `CASE<br>   <br>    WHEN TRY_CAST(mas.SRSECCLAS AS INT) IS NOT NULL <br>      THEN mas.SRSECCLAS <br>    ELSE '0' <br>  END AS SECRTY_CLASS_ID` | -- Source context preserved: FROM ossbr_2_1 mas |
| 12 | `secrty_view_CD` | Set to +01342 (DB). | `CAST(1342 AS BIGINT)` |  |
| 35 | `sm_secrty_id` | Straight move (if date field then set Fromat source date as YYYY-MM-DD) | `TO_DATE(borid, 'YYYY-MM-DD')` |  |
| 36 | `sm_secrty_type_id` | CASE WHEN TRY_CAST(mas.SRSECTYPE AS INT) IS NOT NULL THEN mas.SRSECTYPE ELSE '+00000' END AS sm.SECRTY_TYPE_ID FROM ossbr_2_1 mas | `CASE<br>   <br>    WHEN TRY_CAST(mas.SRSECTYPE AS INT) IS NOT NULL <br>      THEN mas.SRSECTYPE <br>    ELSE '+00000' <br>  END AS sm.SECRTY_TYPE_ID` | -- Source context preserved: FROM ossbr_2_1 mas |
| 17 | `source_appl_CD` | Set to +00239 (GLS) | `CAST(239 AS BIGINT)` |  |
| 41 | `sumary_combin_id` |  | `CAST(NULL AS STRING)` |  |
| 6 | `tantrum_family_CD` | CASE WHEN ref.sm_SECURITY_CODE IS NOT NULL THEN CASE WHEN mas.SRSECTYPE IN ('380','331') THEN '+01313' ELSE '+01316' END ELSE CASE WHEN mas.SRSECTYPE = '220' THEN '+01312' WHEN mas.SRSECTYPE IN ('315','600','520','420','310','330','510') THEN '+01314'  WHEN mas.SRSECTYPE IN ('551','553','555','559','567','550','556','557','570','581','554','558','568','569','573','562','530') THEN '+01315' WHEN mas.SRSECTYPE IN ('210','230','240') THEN '+01309' WHEN mas.SRSECTYPE IN ('263','265','275','260','261','270','262','276','290','295') THEN '+01310' ELSE '+01316'  END END AS tantrum_family_cd LEFT JOIN GLSXREF ref ON mas.SRSECCODE = ref.sm_SECURITY_CODE | `CASE<br>   <br>    WHEN ref.sm_SECURITY_CODE IS NOT NULL <br>      THEN CASE<br>   <br>    WHEN mas.SRSECTYPE IN ('380','331') <br>      THEN '+01313' <br>    ELSE '+01316' <br>  END <br>    ELSE CASE<br>   <br>    WHEN mas.SRSECTYPE = '220' <br>      THEN '+01312' <br>    WHEN mas.SRSECTYPE IN ('315','600','520','420','310','330','510') <br>      THEN '+01314'  <br>    WHEN mas.SRSECTYPE IN ('551','553','555','559','567','550','556','557','570','581','554','558','568','569','573','562','530') <br>      THEN '+01315' <br>    WHEN mas.SRSECTYPE IN ('210','230','240') <br>      THEN '+01309' <br>    WHEN mas.SRSECTYPE IN ('263','265','275','260','261','270','262','276','290','295') <br>      THEN '+01310' <br>    ELSE '+01316'  <br>  END <br>  END AS tantrum_family_cd LEFT JOIN GLSXREF ref ON mas.SRSECCODE = ref.sm_SECURITY_CODE` |  |
| 7 | `tantrum_issued_in` | CASE WHEN ref.sm_SECURITY_CODE IS NOT NULL AND LEFT(ref.SEND_CD, 3) IN ('SBM', 'SBG', 'SBS','SBB', 'SBC') THEN 'Y' WHEN LEFT(mas.SRSHSBESE, 2) = 'SB' THEN 'Y' ELSE 'N' END AS tantrum_issued_in FROM ossbr_2_1 mas LEFT JOIN GLSXREF ref ON mas.SRSECCODE = ref.sm_SECURITY_CODE | `CASE<br>   <br>    WHEN ref.sm_SECURITY_CODE IS NOT NULL AND LEFT(ref.SEND_CD, 3) IN ('SBM', 'SBG', 'SBS','SBB', 'SBC') <br>      THEN 'Y' <br>    WHEN LEFT(mas.SRSHSBESE, 2) = 'SB' <br>      THEN 'Y' <br>    ELSE 'N' <br>  END AS tantrum_issued_in` | -- NOTE: merged 3 duplicate definitions for target column 'tantrum_issued_in' |
| 4 | `tantrum_na` | CASE WHEN ref.sm_SECURITY_CODE IS NOT NULL THEN RTRIM(ref.FUND_DESC) ELSE RTRIM(mas.SRSHSBESE) END AS tantrum_na FROM ossbr_2_1 mas LEFT JOIN GLSXREF ref ON mas.SRSECCODE = ref.sm_SECURITY_CODE | `CASE<br>   <br>    WHEN ref.sm_SECURITY_CODE IS NOT NULL <br>      THEN RTRIM(ref.FUND_DESC) <br>    ELSE RTRIM(mas.SRSHSBESE) <br>  END AS tantrum_na` | -- NOTE: merged 2 variations for target column 'tantrum_na' |
| 1 | `tantrumid` | CASE   WHEN LEFT(GLSXREF.SEND_CD, 3) = 'SBB' THEN     CASE       WHEN SUBSTRING(GLSXREF.SEND_CD, 4, 5) = MFSPRIC.PRC_DTL_SEND_NUM THEN NULL       ELSE         CASE           WHEN SUBSTRING(GLSXREF.SEND_CD, 4, 3) LIKE '[0-9]%' AND SUBSTRING(GLSXREF.SEND_CD, 7, 2) = '*' THEN CONCAT(230000000000, SUBSTRING(GLSXREF.SEND_CD, 4, 3))           WHEN LEN(TRIM(SUBSTRING(GLSXREF.SEND_CD, 4, 5))) > 0 THEN CONCAT(STRING_AGG(FORMAT(ASCII(SUBSTRING(GLSXREF.SEND_CD, 4, 1)), '00')), '000')           ELSE CONCAT('23000', STRING_AGG(FORMAT(ASCII(SUBSTRING(GLSXREF.SEND_CD, 4, 1)), '00')))         END     END   ELSE CONCAT('500', STRING_AGG(FORMAT(ASCII(ossbr_2_1.SRSECCODE), '00'))) END AS tantrum_id FROM ossbr_2_1 LEFT JOIN GLSXREF ON ossbr_2_1.SRSECCODE = GLSXREF.sm_SECURITY_CODE LEFT JOIN MFSPRIC ON SUBSTRING(GLSXREF.SEND_CD, 4, 5) = MFSPRIC.PRC_DTL_SEND_NUM | `CASE<br>  <br>  <br>    WHEN LEFT(GLSXREF.SEND_CD, 3) = 'SBB' <br>      THEN<br>    CASE<br>  <br>      <br>    WHEN SUBSTRING(GLSXREF.SEND_CD, 4, 5) = MFSPRIC.PRC_DTL_SEND_NUM <br>      THEN NULL<br>      <br>    ELSE<br>        CASE<br>  <br>          <br>    WHEN SUBSTRING(GLSXREF.SEND_CD, 4, 3) LIKE '[0-9]%' AND SUBSTRING(GLSXREF.SEND_CD, 7, 2) = '*' <br>      THEN CONCAT(230000000000, SUBSTRING(GLSXREF.SEND_CD, 4, 3))<br>          <br>    WHEN LEN(TRIM(SUBSTRING(GLSXREF.SEND_CD, 4, 5))) > 0 <br>      THEN CONCAT(STRING_AGG(FORMAT(ASCII(SUBSTRING(GLSXREF.SEND_CD, 4, 1)), '00')), '000')<br>          <br>    ELSE CONCAT('23000', STRING_AGG(FORMAT(ASCII(SUBSTRING(GLSXREF.SEND_CD, 4, 1)), '00')))<br>        <br>  END<br>    <br>  END<br>  <br>    ELSE CONCAT('500', STRING_AGG(FORMAT(ASCII(ossbr_2_1.SRSECCODE), '00')))<br><br>  END AS tantrum_id` | -- NOTE: merged 3 duplicate definitions for target column 'tantrumid' |
| 10 | `tct_issue_in` | Set to 'N' | `CAST('N' AS STRING)` |  |
| 42 | `term_family_CD` | Set A to A --1A | `CAST('A' AS BIGINT)` |  |
| 44 | `to_dt` | Set to '9999-12-31' and cast it as date | `CAST('9999-12-31' AS DATE)` |  |
| 39 | `trm_prodct_id` | Set to 0 | `CAST(0 AS BIGINT)` |  |
| 19 | `varble_rate_id` | Set to 0 | `CAST(0 AS BIGINT)` |  |
